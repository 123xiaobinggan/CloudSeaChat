"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("./common/vendor.js");Math;const i={data:()=>({userInfo:{account_id:null,username:"未登录",description:"这个人很懒，什么都没有留下",avatar:"/static/info/未登录.png",level:0,activity:0,coupon:0,points:0,balance:0,ip:"",admin:!1},login_status:!1,activityTimer:null,activityStartTime:null,activityElapsedSeconds:0}),onLaunch:function(){console.log("App Launch"),t.PubSub.subscribe("remind_upgrade",((i,e)=>{console.log("收到升级提醒",e),t.index.showModal({title:"升级了",content:`🎉 恭喜你升级到 V${e}`,showCancel:!1,confirmText:"知道了"})})),t.PubSub.subscribe("update_activity",(async(i,e)=>{const o=getApp();if(o.userInfo.account_id){o.userInfo.activity+=e,o.userInfo.activity>=100&&(o.userInfo.activity%=100,o.userInfo.level+=1,console.log(" 升级了"),t.PubSub.publish("remind_upgrade",o.userInfo.level));try{await t.tr.callFunction({name:"update_activity",data:{account_id:o.userInfo.account_id,level:o.userInfo.level,activity:o.userInfo.activity}})}catch(n){console.error(n)}}else console.log("未登录，跳过更新活动值")}))},onShow:function(){console.log("App Show"),this.activityStartTime=Date.now(),this.activityTimer&&clearInterval(this.activityTimer),this.activityTimer=setInterval((()=>{const i=Date.now(),e=Math.floor((i-this.activityStartTime)/1e3);if(e>this.activityElapsedSeconds){const i=e-this.activityElapsedSeconds;this.activityElapsedSeconds=e;const o=Math.floor(i/60);if(o>0){getApp().userInfo.account_id&&t.PubSub.publish("update_activity",o)}}}),6e4)},onHide:function(){console.log("App Hide"),this.activityTimer&&(clearInterval(this.activityTimer),this.activityTimer=null)}};function e(){return{app:t.createSSRApp(i)}}e().app.mount("#app"),exports.createApp=e;
