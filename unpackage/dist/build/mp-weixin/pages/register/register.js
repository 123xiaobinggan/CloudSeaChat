"use strict";const e=require("../../common/vendor.js"),n={data:()=>({userInfo:{username:"",account_id:"",password:"",description:"这个人很懒，什么都没有留下",avatar:"/static/info/未登录.png",level:0,activity:0,coupon:0,points:0,balance:0},loading:!1}),watch:{loading(n){n?e.index.showLoading({title:"注册中...",mask:!0}):e.index.hideLoading()}},methods:{async handleRegister(){if(console.log("register"),this.userInfo.password&&this.userInfo.username&&this.userInfo.account_id)if(this.userInfo.account_id.length<2||this.userInfo.account_id.length>8)e.index.showToast({title:"账号长度需在2-8个字符之间",icon:"none"});else if(this.userInfo.username.length<2||this.userInfo.username.length>10)e.index.showToast({title:"用户名长度需在2-10个字符之间",icon:"none"});else if(this.userInfo.password.length<6||this.userInfo.password.length>16)e.index.showToast({title:"密码长度需在6-16个字符之间",icon:"none"});else{this.loading=!0;try{const n=await e.tr.callFunction({name:"login_register",data:{action:"register",account_id:this.userInfo.account_id,username:this.userInfo.username,password:this.userInfo.password,has_token:!1}});if(200===n.result.code){const o=getApp();o.userInfo=n.result.userInfo,o.login_status=!0,e.index.setStorageSync("uid",n.result.userInfo.account_id),this.loading=!1,e.index.showToast({title:"注册成功",icon:"success"}),setTimeout((()=>{e.index.switchTab({url:"/pages/my_info/my_info"})}),1e3)}else e.index.showToast({title:n.result.msg,icon:"none"})}catch(n){e.index.showToast({title:"注册失败",icon:"none"}),console.error(n)}finally{this.loading=!1}}else e.index.showToast({title:"用户名或密码不能为空",icon:"none"})},goToLogin(){e.index.switchTab({url:"/pages/login/login"})}}};const o=e._export_sfc(n,[["render",function(n,o,s,t,i,a){return{a:i.userInfo.account_id,b:e.o((e=>i.userInfo.account_id=e.detail.value)),c:i.userInfo.username,d:e.o((e=>i.userInfo.username=e.detail.value)),e:i.userInfo.password,f:e.o((e=>i.userInfo.password=e.detail.value)),g:e.o(((...e)=>a.handleRegister&&a.handleRegister(...e))),h:e.o(((...e)=>a.goToLogin&&a.goToLogin(...e)))}}]]);wx.createPage(o);
