{"version":3,"file":"deposit.js","sources":["pages/deposit/deposit.vue","../../../H-builderx/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGVwb3NpdC9kZXBvc2l0LnZ1ZQ"],"sourcesContent":["<template>\n  \t<view class=\"deposit-container\">\n\t\t<view class=\"deposit-header\" @tap=\"handleBodyTap\">\n\t\t\t<view class=\"deposit-header-title\">\n\t\t\t\t<text>充值给</text>\n\t\t\t</view>\t\n\t\t\t<view class=\"user-header\">\n\t\t\t\t<text>{{ userInfo.username }}</text>\n\t\t\t\t<text>({{ userInfo.account_id }})</text>\n\t\t\t</view>\n\t\t\t<img :src=\"userInfo.avatar\" class=\"avatar\" />\n\t\t\t\n\t\t</view>\n\n\t\t<view class=\"deposit-body\" @tap=\"handleBodyTap\">\n\t\t\t<view class=\"input-amount\">\n\t\t\t\t<text class=\"amount\">金额</text>\n\t\t\t\t<view class=\"input-body\" @tap.stop=\"isInputFocused = true\">\n\t\t\t\t\t<img src=\"/static/deposit/人民币符号.png\" class=\"RMB\">\n\t\t\t\t\t\n\t\t\t\t\t<view class=\"fake-input\">\n\t\t\t\t\t\t<text>{{ rechargeAmount }}</text>\n\t\t\t\t\t\t<view v-if=\"isInputFocused\" class=\"cursor\"></view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<view  \n\t\t\t\tv-show=\"isInputFocused\" \n\t\t\t\t:class=\"{'keyboard-hidden': !isInputFocused}\"\n\t\t\t\tclass=\"keyboard\" \n\t\t\t\t@tap.stop\n\t\t\t>\n\t\t\t\t<!-- 九宫格 -->\n\t\t\t\t<view class=\"left-button\">\n\t\t\t\t\t<view class=\"nine-keyboard\">\n\t\t\t\t\t\t<view \n\t\t\t\t\t\t\tv-for=\"(key, index) in keys\" \n\t\t\t\t\t\t\t:key=\"index\" \n\t\t\t\t\t\t\tclass=\"key-item\" \n\t\t\t\t\t\t\t:class=\"{ 'active': activeiIndex === index}\"\n\t\t\t\t\t\t\t@tap.stop=\"handleKeyPress(key)\"\n\t\t\t\t\t\t\t@touchstart=\"setActive(index)\"\n\t\t\t\t\t\t\t@touchend=\"removeActive(index)\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ key }}\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"bottom-button\" >\n\t\t\t\t\t\t<view \n\t\t\t\t\t\t\tclass=\"button-0\" \n\t\t\t\t\t\t\t:class=\"{ 'active': activeiIndex === '0'}\"\n\t\t\t\t\t\t\t@tap.stop=\"handleKeyPress('0')\" \n\t\t\t\t\t\t\t@touchstart=\"setActive('0')\"\n\t\t\t\t\t\t\t@touchend=\"removeActive('0')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<text>0</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view \n\t\t\t\t\t\t\tclass=\"dot-button\" \n\t\t\t\t\t\t\t:class=\"{ 'active': activeiIndex === '.'}\"\n\t\t\t\t\t\t\t@tap.stop=\"handleKeyPress('.')\"\n\t\t\t\t\t\t\t@touchstart=\"setActive('.')\"\n\t\t\t\t\t\t\t@touchend=\"removeActive('.')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<text>.</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"right-button\">\n\t\t\t\t\t<!-- 退格 -->\n\t\t\t\t\t<view \n\t\t\t\t\t\tclass=\"back-item\" \n\t\t\t\t\t\t:class=\"{ 'active': activeiIndex === 'back'}\"\n\t\t\t\t\t\t@tap.stop=\"handleBackspace\"\n\t\t\t\t\t\t@touchstart=\"setActive('back')\"\n\t\t\t\t\t\t@touchend=\"removeActive('back')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<image src=\"/static/deposit/退格键.png\" class=\"back-icon\" />\n\t\t\t\t\t</view>\n\n\t\t\t\t\t\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<!-- 充值键 -->\n\t\t\t<view \n\t\t\t\tclass=\"deposit-button\" \n\t\t\t\t:class=\"{ 'active1': hasInput, 'active2': activeiIndex === 'deposit','focused': isInputFocused }\"\n\t\t\t\t@tap.stop=\"handleDeposit\"\n\t\t\t\t@touchstart=\"setActive('deposit')\"\n\t\t\t\t@touchend=\"removeActive('deposit')\"\n\t\t\t>\n\t\t\t\t<text>充值</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n\n    \n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n\t  userInfo: {\n        account_id: '',\n        username: '未登录',\n        avatar: '/static/info/未登录.png',\n\t  },\n\t  keys: [\n        '1', '2', '3',\n        '4', '5', '6',\n        '7', '8', '9', \n      ],\n      rechargeAmount: '', // 当前充值金额\n      isInputFocused: false, // 输入框是否获得焦点\n\t  hasInput: false, // 是否有输入\n\t  activeiIndex: -1, // 当前激活的按键索引\n    };\n  },\n  watch:{\n\t  rechargeAmount(){\n\t\tthis.isInputFocused = true;\n\t\tthis.hasInput = this.rechargeAmount.toString().trim() !=='' && this.rechargeAmount >0;\n\t  }\n  },\n  onLoad(){\n\t  const app = getApp();\n\t  this.userInfo = app.userInfo;\n\t  this.isInputFocused = true;\n  },\n\n  methods: {\n\thandleKeyPress(key) {\n\t\tthis.triggerVibrate();\n\t\tthis.isInputFocused = true;\n\t\tif(this.rechargeAmount.includes('.')){\n\t\t\tconst decimalPart = this.rechargeAmount.split('.')[1];\n\t\t\tif(decimalPart.length>=2 || key==='.'){\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif(key==='.' && this.rechargeAmount===''){\n\t\t\tthis.rechargeAmount = '0';\n\t\t}\n\t\tthis.rechargeAmount += key;\n\t},\n\thandleBackspace() {\n\t\tthis.triggerVibrate();\n    \tthis.rechargeAmount = this.rechargeAmount.slice(0, -1);\n  \t},\n\thandleBodyTap() {\n    \tthis.isInputFocused = false;\n  \t},\n\tsetActive(index){\n\t\tthis.activeiIndex = index;\n\t},\n\tremoveActive(){\n\t\tthis.activeiIndex = -1;\n\t},\n\tasync handleDeposit(){\n\t\tthis.triggerVibrate();\n\t\tconst amount = parseFloat(parseFloat(this.rechargeAmount).toFixed(2));\n\t\tif(amount<=0){\n\t\t\tuni.showToast({ title: '充值金额必须大于0', icon:'none' })\n\t\t\treturn;\n\t\t}\n\t\tuni.showLoading({ title: '充值中...' })\n\t\tconsole.log('充值金额',amount,'元')\n\t\tconst res = await uniCloud.callFunction({\n\t\t\tname: 'deposit',\n\t\t\tdata: {\n\t\t\t\taccount_id: this.userInfo.account_id,\n\t\t\t\tamount: amount\n\t\t\t}\n\t\t})\n\t\tif(res.result.code===200){\n\t\t\tuni.hideLoading()\n\t\t\tuni.showToast({ title: '充值成功', icon:'success' })\n\t\t\tconst app = getApp();\n\t\t\tapp.userInfo.balance += amount;\n\t\t\tapp.userInfo.balance = parseFloat(parseFloat(app.userInfo.balance).toFixed(2));\n\t\t\tsetTimeout(() => {\n\t\t\t\tuni.navigateBack();\n\t\t\t},1000)\n\t\t}\n\t\telse{\n\t\t\tuni.showToast({ title: '充值失败', icon:'none' })\n\t\t}\n\t\tuni.hideLoading()\n\t\t\n\t},\n\ttriggerVibrate() {\n\t\tuni.vibrateShort(); // 模拟轻微反馈\n\t\tsetTimeout(() => {\n\t\t\tuni.vibrateShort(); // 再次模拟轻微反馈\n\t\t}, 10);\n\t\tsetTimeout(() => {\n\t\t\tuni.vibrateShort(); // 再次模拟轻微反馈\n\t\t}, 20);\n\t\tsetTimeout(() => {\n\t\t\tuni.vibrateShort(); // 再次模拟轻微反馈\n\t\t}, 30);\n\t},\n  },\n  \n  \n};\n</script>\n\n<style scoped>\n@import url(deposit.css)\n</style>\n","import MiniProgramPage from 'D:/CODE/vue/canteen_program/pages/deposit/deposit.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":"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"}