{"version":3,"file":"my_info.js","sources":["pages/my_info/my_info.vue","../../../H-builderx/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbXlfaW5mby9teV9pbmZvLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"content\">\n    <image class=\"background-image\" :src=\"'/static/info/背景.png'\" mode=\"aspectFill\" />\n    <view class=\"profile-card\">\n      <view class=\"header\">\n        <image class=\"avatar\" :src=\"userInfo.avatar\" mode=\"aspectFill\" @tap=\"to_detail\" />\n        <view class=\"user-main\">\n          <view class=\"nickname-and-tags\">\n            <text class=\"nickname\">{{ userInfo.username }}</text>\n            <view class=\"account_id-and-tags\">\n              <text class=\"account-id\">ID: {{ userInfo.account_id }}</text>\n              <view class=\"level-and-activity\">\n                <text class=\"level-tag\">V{{ userInfo.level }}</text>\n                <text class=\"activity\">活力值 {{ userInfo.activity }}</text>\n              </view>\n            </view>\n          </view>\n          <text class=\"desc\">{{userInfo.description}}</text>\n        </view>\n        <!-- 编辑 -->\n        <view class=\"edit-btn\" v-show=\"login_status\" @tap=\"goToEdit\">\n            <image src=\"/static/info/编辑.png\" mode=\"aspectFit\" />\n        </view>\n      </view>\n      <!-- 登录 -->\n      <button class=\"login-btn\" v-show=\"!login_status\" @tap=\"login\">立即登录</button>\n      <button class=\"login-btn\" v-show=\"login_status\" @tap=\"logout\">退出登录</button>\n\n      <view class=\"stats\">\n        <view class=\"stat-item\">\n          <text class=\"stat-value\">{{ userInfo.coupon }}</text>\n          <text class=\"stat-label\">优惠券</text>\n        </view>\n        <view class=\"stat-item\">\n          <text class=\"stat-value\">{{ userInfo.points }}</text>\n          <text class=\"stat-label\">我的积分</text>\n        </view>\n        <view class=\"stat-item\" @tap=\"deposit\">\n          <text class=\"stat-value\">{{ userInfo.balance }}</text>\n          <text class=\"stat-label\">余额</text>\n        </view>\n      </view>\n\n      <view class=\"progress-text\">\n        距离升级还差 {{ 100-userInfo.activity%100 }} 活力值\n      </view>\n      <view class=\"progress-bar\">\n        <view class=\"progress-inner\" :style=\"'width:' + userInfo.activity + '%'\"></view>\n      </view>\n    </view>\n    <view class=\"meteor-container\">\n      <view\n        v-for=\"meteor in meteors\"\n        :key=\"meteor.id\"\n        class=\"meteor\"\n        :style=\"meteor.style\"\n      />\n    </view>\n  </view>\n</template>\n\n<script>\nimport PubSub from 'pubsub-js';\n export default {\n   data() {\n     return {\n       meteors: [],\n       meteorId: 0,\n       userInfo: {\n        account_id: '',\n        username: '未登录',\n        description: '这个人很懒，什么都没有留下',\n        avatar: '/static/info/未登录.png',\n        level: 0,\n        activity: 0,\n        coupon: 0,\n        points: 0,\n        balance: 0,\n        admin: false \n       },\n       login_status: false,\n       token: ''\n     };\n   },\n   watch:{\n   },\n   onShow() {\n    setTimeout(() => {\n      const app = getApp();\n      if(app.userInfo) {\n        Object.assign(this.userInfo,app.userInfo);\n        this.login_status = app.login_status;\n        if(this.userInfo.unread_messages){\n          uni.showTabBarRedDot({\n            index: 1,\n          });\n        }\n      }\n      console.log('onShow',this.userInfo);\n    }, 100);\n   },\n   moundted(){\n    this.startMeteorShower();\n   },\n   onLoad() {\n\n   },\n   onUnload() {\n     if(this.token){\n       PubSub.unsubscribe(this.token);\n       this.token = null;\n     }\n   },\n   methods: {\n     goToEdit() { \n      uni.navigateTo({\n        url: `/pages/edit/edit`,\n      });\n     },\n     to_detail(){\n      uni.showActionSheet({\n        itemList: ['编辑资料','个人主页'],\n        success: (res) => {\n          if (res.tapIndex === 0) {\n            this.goToEdit();\n          }\n          else if (res.tapIndex === 1) {\n            uni.navigateTo({\n              url: `/pages/personal_info/personal_info?account_id=${this.userInfo.account_id}&visitor_account_id=${this.userInfo.account_id}&visitor_admin=${this.userInfo.admin}`,\n            });\n          }\n        }\n      });\n     },\n     startMeteorShower() {\n       setInterval(() => {\n         const id = this.meteorId++;\n         const startLeft = Math.random() * 100;\n         const startTop = Math.random() * 100;\n         const length = 100 + Math.random() * 100;\n         const opacity = 0.3 + Math.random() * 0.5;\n         const duration = 0.5 + Math.random();\n   \n         const color = ['#fff', '#bde2ff', '#f0c9ff'][Math.floor(Math.random() * 3)];\n   \n         this.meteors.push({\n           id,\n           style: `\n             left: ${startLeft}%;\n             top: ${startTop}%;\n             width: ${length}rpx;\n             height: 2rpx;\n             opacity: ${opacity};\n             background: linear-gradient(to right, ${color}, transparent);\n             animation: meteor-fly ${duration}s linear forwards;\n           `\n         });\n   \n         setTimeout(() => {\n           this.meteors = this.meteors.filter(m => m.id !== id);\n         }, duration * 1000);\n       }, 300);\n     },\n     login() {\n       uni.navigateTo({\n           url: '/pages/login/login'\n         })\n     },\n     logout() {\n      uni.showToast({ title: '退出登录', icon:'success' })\n      this.login_status = false\n      this.userInfo = {\n        username: '未登录',\n        account_id: '',\n        description: '这个人很懒，什么都没有留下',\n        avatar: '/static/info/未登录.png',\n        level: 0,\n        activity: 0,\n        coupon: 0,\n        points: 0,\n        balance: 0,\n        admin: false\n      },\n      uni.removeStorageSync('uid');\n      const app = getApp();\n      app.userInfo = this.userInfo;\n      app.login_status = this.login_status;\n      uni.hideTabBarRedDot({\n        index: 1,\n      });\n     },\n     deposit(){\n      uni.navigateTo({\n        url: \"/pages/deposit/deposit\"\n      })\n     }\n   }\n };\n</script>\n\n<style lang=\"scss\" scoped>\n@import url(my_info.css);\n</style>","import MiniProgramPage from 'D:/CODE/vue/canteen_program/pages/my_info/my_info.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","PubSub"],"mappings":"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"}