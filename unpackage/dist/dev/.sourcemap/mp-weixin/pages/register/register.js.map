{"version":3,"file":"register.js","sources":["pages/register/register.vue","../../../H-builderx/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcmVnaXN0ZXIvcmVnaXN0ZXIudnVl"],"sourcesContent":["<template>\r\n  <view class=\"register-container\">\r\n    <input v-model=\"userInfo.account_id\" placeholder=\"ID(2-13个字符)\" class=\"input-field\" />\r\n    <input v-model=\"userInfo.username\" placeholder=\"用户名\" class=\"input-field\" />\r\n    <input v-model=\"userInfo.password\" type=\"password\" placeholder=\"密码\" class=\"input-field\" />\r\n    <button @tap=\"handleRegister\" class=\"register-button\">注册</button>\r\n    <view class=\"login-link\" @tap=\"goToLogin\">已有账号？去登录</view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport PubSub from 'pubsub-js';\r\nexport default {\r\n  data() {\r\n    return {\r\n      userInfo: {\r\n        username: '',\r\n        account_id: '',\r\n        password: '',\r\n        description: '这个人很懒，什么都没有留下',\r\n        avatar: '/static/info/未登录.png',\r\n        level: 0,\r\n        activity: 0,\r\n        coupon: 0,\r\n        points: 0,\r\n        balance: 0,\r\n      },\r\n      loading : false,\r\n    }\r\n  },\r\n  watch:{\r\n    loading(val){\r\n      if(val){\r\n        uni.showLoading({ title: '注册中...', mask: true });\r\n      }else{\r\n        uni.hideLoading();\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    async handleRegister() {\r\n      console.log('register')\r\n      if (!this.userInfo.password || !this.userInfo.username || !this.userInfo.account_id) {\r\n        uni.showToast({ title: '用户名或密码不能为空', icon: 'none' })\r\n        return;\r\n      }\r\n      if(this.userInfo.account_id.length < 2 || this.userInfo.account_id.length > 8) {\r\n        uni.showToast({ title: '账号长度需在2-8个字符之间', icon: 'none' })\r\n        return;\r\n      } \r\n      if(this.userInfo.username.length < 2 || this.userInfo.username.length > 10) {\r\n        uni.showToast({ title: '用户名长度需在2-10个字符之间', icon: 'none' })\r\n        return;\r\n      }\r\n      if (this.userInfo.password.length < 6 || this.userInfo.password.length > 16) {\r\n        uni.showToast({ title: '密码长度需在6-16个字符之间', icon: 'none' })\r\n        return;\r\n      }\r\n      this.loading = true;\r\n      try {\r\n        const res = await uniCloud.callFunction({\r\n          name: 'login_register',\r\n          data: {\r\n            action: 'register',\r\n            account_id: this.userInfo.account_id,\r\n            username: this.userInfo.username,\r\n            password: this.userInfo.password,\r\n            has_token: false\r\n          }\r\n        });\r\n\r\n        if (res.result.code === 200) {\r\n          // PubSub.publish('Register', res.result);\r\n          const app = getApp();\r\n          app.userInfo = res.result.userInfo;\r\n          app.login_status = true;\r\n          uni.setStorageSync('uid', res.result.userInfo.account_id);\r\n          this.loading = false;\r\n          uni.showToast({ title: '注册成功', icon:'success' })\r\n          setTimeout(() => {\r\n            uni.switchTab({ url: '/pages/my_info/my_info' })\r\n          },1000)\r\n        } else {\r\n          uni.showToast({ title: res.result.msg, icon: 'none'})\r\n        }\r\n      } catch (e) {\r\n        uni.showToast({ title: '注册失败', icon: 'none' })\r\n        console.error(e)\r\n      }finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    goToLogin() {\r\n      uni.switchTab({\r\n        url: '/pages/login/login'\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n@import url(register.css);\r\n</style>","import MiniProgramPage from 'D:/CODE/vue/canteen_program/pages/register/register.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":";;AAYA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,UAAU;AAAA,QACR,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,UAAU;AAAA,QACV,aAAa;AAAA,QACb,QAAQ;AAAA,QACR,OAAO;AAAA,QACP,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,QAAQ;AAAA,QACR,SAAS;AAAA,MACV;AAAA,MACD,SAAU;AAAA,IACZ;AAAA,EACD;AAAA,EACD,OAAM;AAAA,IACJ,QAAQ,KAAI;AACV,UAAG,KAAI;AACLA,sBAAG,MAAC,YAAY,EAAE,OAAO,UAAU,MAAM,KAAG,CAAG;AAAA,aAC5C;AACHA,sBAAG,MAAC,YAAW;AAAA,MACjB;AAAA,IACF;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACP,MAAM,iBAAiB;AACrBA,oBAAAA,wDAAY,UAAU;AACtB,UAAI,CAAC,KAAK,SAAS,YAAY,CAAC,KAAK,SAAS,YAAY,CAAC,KAAK,SAAS,YAAY;AACnFA,sBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,QAAQ;AACnD;AAAA,MACF;AACA,UAAG,KAAK,SAAS,WAAW,SAAS,KAAK,KAAK,SAAS,WAAW,SAAS,GAAG;AAC7EA,sBAAG,MAAC,UAAU,EAAE,OAAO,kBAAkB,MAAM,QAAQ;AACvD;AAAA,MACF;AACA,UAAG,KAAK,SAAS,SAAS,SAAS,KAAK,KAAK,SAAS,SAAS,SAAS,IAAI;AAC1EA,sBAAG,MAAC,UAAU,EAAE,OAAO,oBAAoB,MAAM,QAAQ;AACzD;AAAA,MACF;AACA,UAAI,KAAK,SAAS,SAAS,SAAS,KAAK,KAAK,SAAS,SAAS,SAAS,IAAI;AAC3EA,sBAAG,MAAC,UAAU,EAAE,OAAO,mBAAmB,MAAM,QAAQ;AACxD;AAAA,MACF;AACA,WAAK,UAAU;AACf,UAAI;AACF,cAAM,MAAM,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACtC,MAAM;AAAA,UACN,MAAM;AAAA,YACJ,QAAQ;AAAA,YACR,YAAY,KAAK,SAAS;AAAA,YAC1B,UAAU,KAAK,SAAS;AAAA,YACxB,UAAU,KAAK,SAAS;AAAA,YACxB,WAAW;AAAA,UACb;AAAA,QACF,CAAC;AAED,YAAI,IAAI,OAAO,SAAS,KAAK;AAE3B,gBAAM,MAAM;AACZ,cAAI,WAAW,IAAI,OAAO;AAC1B,cAAI,eAAe;AACnBD,wBAAG,MAAC,eAAe,OAAO,IAAI,OAAO,SAAS,UAAU;AACxD,eAAK,UAAU;AACfA,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAK,WAAW;AAC/C,qBAAW,MAAM;AACfA,0BAAAA,MAAI,UAAU,EAAE,KAAK,0BAA0B;AAAA,UAChD,GAAC,GAAI;AAAA,eACD;AACLA,8BAAI,UAAU,EAAE,OAAO,IAAI,OAAO,KAAK,MAAM,OAAM,CAAC;AAAA,QACtD;AAAA,MACF,SAAS,GAAG;AACVA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAC7CA,sBAAAA,MAAA,MAAA,SAAA,qCAAc,CAAC;AAAA,MACjB,UAAC;AACC,aAAK,UAAU;AAAA,MACjB;AAAA,IACD;AAAA,IACD,YAAY;AACVA,oBAAAA,MAAI,UAAU;AAAA,QACZ,KAAK;AAAA,OACN;AAAA,IACH;AAAA,EACF;AACF;;;;;;;;;;;;;;ACjGA,GAAG,WAAW,eAAe;"}