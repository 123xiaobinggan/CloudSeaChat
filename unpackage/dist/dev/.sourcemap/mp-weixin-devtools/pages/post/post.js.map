{"version":3,"names":["_sfc_main","data","posts","content","images","permissionText","permissionOptions","user","account_id","username","avatar","onload","options","methods","chooseImages","_this","common_vendor","index","chooseImage","count","length","success","res","concat","tempFilePaths","previewImage","current","urls","removeImage","splice","onPermissionChange","e","detail","value","post","trim","showToast","title","icon","callFunction","name","post_type","source_post_id","visibility","create_time","Date","toISOString","ip","tags","status","result","unshift","navigateBack","wx","createPage","MiniProgramPage"],"sources":["post.vue","cGFnZXMvcG9zdC9wb3N0LnZ1ZQ"],"sourcesContent":["<template>\r\n    <view class=\"post-page\">\r\n      <!-- 顶部栏 -->\r\n      <view class=\"nav-bar\">\r\n        <text class=\"title\">创作</text>\r\n        <button class=\"publish-btn\" size=\"mini\" @tap=\"post\">发表</button>\r\n      </view>\r\n  \r\n      <!-- 内容输入框 -->\r\n      <view class=\"content-card\">\r\n        <textarea\r\n          v-model=\"content\"\r\n          class=\"content-input\"\r\n          placeholder=\"分享新鲜事...\"\r\n          maxlength=\"500\"\r\n        />\r\n        <view class=\"image-grid\">\r\n          <view\r\n            v-for=\"(img, index) in images\"\r\n            :key=\"index\"\r\n            class=\"image-item\"\r\n            @tap=\"()=>previewImage(index)\"\r\n          >\r\n            <image :src=\"img\" class=\"post-image\" mode=\"aspectFill\" />\r\n            <!-- 删除按钮 -->\r\n            <view class=\"delete-btn\" @tap.stop=\"()=>removeImage(index)\">×</view>\r\n          </view>\r\n          <!-- 添加图片按钮 -->\r\n          <view\r\n            v-if=\"images.length < 9\"\r\n            class=\"image-item add-image\"\r\n            @tap=\"chooseImages\"\r\n          >\r\n            <image src=\"/static/post/add_img.png\" class=\"add-icon\" />\r\n            <text>照片/视频</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n  \r\n      <!-- 功能区 -->\r\n      <view class=\"options-card\">\r\n        <view class=\"option-item\">\r\n          <text>添加标签</text>\r\n        </view>\r\n        <view class=\"option-item\">\r\n          <text>添加地点</text>\r\n        </view>\r\n      </view>\r\n  \r\n      <!-- 权限和定时 -->\r\n      <view class=\"options-card\">\r\n        <view class=\"option-item\">\r\n          <text>权限设置</text>\r\n          <picker mode=\"selector\" :range=\"permissionOptions\" @change=\"onPermissionChange\">\r\n            <text class=\"option-value\">{{ permissionText }}</text>\r\n          </picker>\r\n        </view>\r\n      </view>\r\n    </view>\r\n</template>\r\n  \r\n  \r\n<script>\r\n  export default {\r\n    data() {\r\n      return {\r\n        posts: [], // post列表\r\n        content: '',\r\n        images: [],\r\n        permissionText: '所有人可见',\r\n        permissionOptions: ['所有人可见', '仅我可见'],\r\n        user:{\r\n          account_id: '',\r\n          username: '未登录',\r\n          avatar: ''\r\n        }\r\n      };\r\n    },\r\n    onload(options){\r\n      this.user.account_id = options.account_id;\r\n      this.user.username = options.username;\r\n      this.user.avatar = options.avatar;\r\n      this.posts = options.posts;\r\n    },\r\n    methods: {\r\n      chooseImages() {\r\n        uni.chooseImage({\r\n          count: 9 - this.images.length,\r\n          success: (res) => {\r\n            this.images = this.images.concat(res.tempFilePaths);\r\n          }\r\n        });\r\n      },\r\n      previewImage(index) {\r\n        uni.previewImage({\r\n          current: this.images[index],\r\n          urls: this.images\r\n        });\r\n      },\r\n      removeImage(index) {\r\n        this.images.splice(index, 1); // 删除选中的图片\r\n      },\r\n      onPermissionChange(e) {\r\n        this.permissionText = this.permissionOptions[e.detail.value];\r\n      },\r\n      post(){\r\n        if (!this.content.trim() && this.images.length === 0) {\r\n          uni.showToast({\r\n            title: '内容不能为空',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        } \r\n        const res = uni.callFunction({\r\n            name: 'post',\r\n            data: {\r\n                user:this.user,\r\n                content: this.content,\r\n                images: this.images,\r\n                post_type: 0,\r\n                source_post_id: '',\r\n                visibility: this.permissionText,\r\n                create_time: new Date().toISOString(),\r\n                ip: '厦门',\r\n                tags: [],\r\n                status: 1\r\n            }\r\n          });\r\n        if(res.result.status === 200){\r\n            uni.showToast({\r\n                title: '发布成功',\r\n                icon: 'success'\r\n            });\r\n            posts.unshift(res.result.data);\r\n            uni.navigateBack();\r\n            } \r\n        else if(res.result.status === 401){\r\n            uni.showToast({\r\n                title: '请登录',\r\n                icon: 'none'\r\n            });\r\n        }\r\n        else{\r\n            uni.showToast({\r\n                title: '发布失败',\r\n                icon: 'none'\r\n            });\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n  \r\n<style scoped>\r\n@import url('post.css');\r\n</style>","import MiniProgramPage from 'D:/CODE/vue/canteen_program/pages/post/post.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}