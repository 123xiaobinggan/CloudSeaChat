{"version":3,"names":["_sfc_main","data","userInfo","username","description","avatar","oldPassword","password","confirmPassword","methods","chooseAvatar","_this","common_vendor","index","chooseImage","count","success","res","tempFilePaths","saveProfile","_this2","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","wrap","_callee$","_context","prev","next","showToast","title","icon","abrupt","er","callFunction","name","action","newPassword","sent","result","code","utils_pubsub","pubsub","publish","navigateBack","msg","t0","stop","onLoad","_this3","eventChannel","getOpenerEventChannel","on","mounted","wx","createPage","MiniProgramPage"],"sources":["edit.vue","cGFnZXMvZWRpdC9lZGl0LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"edit-container\">\r\n    <view class=\"avatar-upload\">\r\n      <image class=\"avatar\" :src=\"userInfo.avatar\"></image>\r\n      <button class=\"upload-btn\" @click=\"chooseAvatar\">更换头像</button>\r\n    </view>\r\n    \r\n    <input v-model=\"userInfo.username\" placeholder=\"用户名\" class=\"input-field\" />\r\n    <input v-model=\"userInfo.description\" placeholder=\"个人简介\" class=\"input-field\" />\r\n    <input v-model=\"oldPassword\" type=\"password\" placeholder=\"原密码\" class=\"input-field\" />\r\n    <input v-model=\"password\" type=\"password\" placeholder=\"新密码\" class=\"input-field\" />\r\n    <input v-model=\"confirmPassword\" type=\"password\" placeholder=\"确认密码\" class=\"input-field\" />\r\n    \r\n    <button class=\"save-btn\" @click=\"saveProfile\">保存修改</button>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { pubsub } from '../../utils/pubsub'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      userInfo: {\r\n        username: '',\r\n        description: '',\r\n        avatar: '/static/info/头像.png'\r\n      },\r\n      oldPassword: '',\r\n      password: '',\r\n      confirmPassword: ''\r\n    }\r\n  },\r\n  methods: {\r\n    chooseAvatar() {\r\n      uni.chooseImage({\r\n        count: 1,\r\n        success: (res) => {\r\n          this.userInfo.avatar = res.tempFilePaths[0]\r\n        }\r\n      })\r\n    },\r\n    async saveProfile() \r\n    {\r\n        if(this.password)\r\n        {\r\n        if (!this.oldPassword) \r\n        {\r\n            uni.showToast({ title: '请输入原密码', icon: 'none' })\r\n            return\r\n        }\r\n        \r\n        if (this.password !== this.confirmPassword) \r\n        {\r\n            uni.showToast({ title: '两次密码不一致', icon: 'none' })\r\n            return\r\n        }\r\n        }\r\n        // console.log(this.userInfo)\r\n      \r\n        try {\r\n            const res = await uniCloud.callFunction({\r\n            name: 'update',\r\n            data: {\r\n                action: 'updatePassword',\r\n                oldPassword: this.oldPassword,\r\n                newPassword: this.password,\r\n                userInfo: this.userInfo\r\n            }\r\n            })\r\n            \r\n            if (res.result.code === 0) {\r\n            uni.showToast({ title: '保存成功', icon: 'success' })\r\n            pubsub.publish('userInfoUpdate', this.userInfo)\r\n            uni.navigateBack()\r\n            } else {\r\n            uni.showToast({ title: res.result.msg, icon: 'none' })\r\n            }\r\n        } catch (e) {\r\n            uni.showToast({ title: '保存失败', icon: 'none' })\r\n        }\r\n    }\r\n  },\r\n  onLoad() {\r\n    const eventChannel = this.getOpenerEventChannel()\r\n    eventChannel.on('acceptDataFromOpenerPage', (data) => {\r\n      this.userInfo = data\r\n    })\r\n  },\r\n  mounted() {\r\n    }\r\n\r\n}\r\n</script>\r\n\r\n<style>\r\n@import url('/pages/edit/edit.css');\r\n</style>","import MiniProgramPage from 'D:/CODE/vue/canteen_program/pages/edit/edit.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}