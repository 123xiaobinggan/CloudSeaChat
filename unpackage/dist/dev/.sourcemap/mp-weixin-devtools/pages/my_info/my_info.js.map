{"version":3,"names":["_sfc_main","data","meteors","meteorId","userInfo","username","account_id","description","avatar","level","activity","coupon","points","balance","login_status","mounted","_this","startMeteorShower","common_vendor","PubSub","subscribe","msg","Object","keys","forEach","key","beforeDestroy","unsubscribe","methods","goToEdit","pubsub","publish","index","navigateTo","url","_this2","setInterval","id","startLeft","Math","random","startTop","length","opacity","duration","color","floor","push","style","concat","setTimeout","filter","m","login","logout","showToast","title","icon","wx","createPage","MiniProgramPage"],"sources":["my_info.vue","cGFnZXMvbXlfaW5mby9teV9pbmZvLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"content\">\n    <image class=\"background-image\" :src=\"'/static/info/背景.png'\" mode=\"aspectFill\" />\n    <view class=\"profile-card\">\n      <view class=\"header\">\n        <image class=\"avatar\" :src=\"userInfo.avatar\"></image>\n        <view class=\"user-main\">\n          <view class=\"nickname-and-tags\">\n            <text class=\"nickname\">{{ userInfo.username }}</text>\n            <text class=\"account-id\">ID: {{ userInfo.account_id }}</text>\n            <view class=\"tags\">\n              <text class=\"level-tag\">V{{ userInfo.level }}</text>\n              <text class=\"activity\">活力值 {{ userInfo.activity }}</text>\n            </view>\n          </view>\n          <text class=\"desc\">{{userInfo.description}}</text>\n        </view>\n        <!-- 编辑 -->\n        <view class=\"edit-btn\" v-show=\"login_status\" @click=\"goToEdit\">\n            <image src=\"/static/info/编辑.png\" mode=\"aspectFit\" />\n        </view>\n      </view>\n      <!-- 登录 -->\n      <button class=\"login-btn\" v-show=\"!login_status\" @click=\"login\">立即登录</button>\n      <button class=\"login-btn\" v-show=\"login_status\" @click=\"logout\">退出登录</button>\n\n      <view class=\"stats\">\n        <view class=\"stat-item\">\n          <text class=\"stat-value\">{{ userInfo.coupon }}</text>\n          <text class=\"stat-label\">优惠券</text>\n        </view>\n        <view class=\"stat-item\">\n          <text class=\"stat-value\">{{ userInfo.points }}</text>\n          <text class=\"stat-label\">我的积分</text>\n        </view>\n        <view class=\"stat-item\">\n          <text class=\"stat-value\">{{ userInfo.balance }}</text>\n          <text class=\"stat-label\">余额</text>\n        </view>\n      </view>\n\n      <view class=\"progress-text\">\n        距离升级还差 {{ 100 - userInfo.points }} 积分\n      </view>\n      <view class=\"progress-bar\">\n        <view class=\"progress-inner\" :style=\"'width:' + userInfo.points + '%'\"></view>\n      </view>\n    </view>\n    <view class=\"meteor-container\">\n      <view\n        v-for=\"meteor in meteors\"\n        :key=\"meteor.id\"\n        class=\"meteor\"\n        :style=\"meteor.style\"\n      />\n    </view>\n  </view>\n</template>\n\n<script>\nimport PubSub from 'pubsub-js';\n export default {\n   data() {\n     return {\n       meteors: [],\n       meteorId: 0,\n       userInfo: {\n         username: '未登录',\n         account_id: '',\n         description: '这个人很懒，什么都没有留下',\n         avatar: '/static/info/未登录.png',\n         level: 0,\n         activity: 0,\n         coupon: 0,\n         points: 0,\n         balance: 0\n       },\n       login_status: false\n     };\n   },\n   mounted() {\n     this.startMeteorShower();\n     \n     PubSub.subscribe('userInfoUpdate', (msg,userInfo) => {\n      Object.keys(this.userInfo).forEach((key) => {\n      if (key in userInfo) {\n        this.userInfo[key] = userInfo[key];\n      }\n      });\n      this.login_status = true;\n     });\n   },\n   beforeDestroy() {\n     PubSub.unsubscribe('userInfoUpdate');\n   },\n   methods: {\n     goToEdit() {\n      pubsub.publish('userInfo_edit', this.userInfo.account_id)\n      uni.navigateTo({\n        url: '/pages/edit/edit'\n      });\n     },\n     startMeteorShower() {\n       setInterval(() => {\n         const id = this.meteorId++;\n         const startLeft = Math.random() * 100;\n         const startTop = Math.random() * 100;\n         const length = 100 + Math.random() * 100;\n         const opacity = 0.3 + Math.random() * 0.5;\n         const duration = 0.5 + Math.random();\n   \n         const color = ['#fff', '#bde2ff', '#f0c9ff'][Math.floor(Math.random() * 3)];\n   \n         this.meteors.push({\n           id,\n           style: `\n             left: ${startLeft}%;\n             top: ${startTop}%;\n             width: ${length}rpx;\n             height: 2rpx;\n             opacity: ${opacity};\n             background: linear-gradient(to right, ${color}, transparent);\n             animation: meteor-fly ${duration}s linear forwards;\n           `\n         });\n   \n         setTimeout(() => {\n           this.meteors = this.meteors.filter(m => m.id !== id);\n         }, duration * 1000);\n       }, 300);\n     },\n     login() {\n       uni.navigateTo({\n           url: '/pages/login/login'\n         })\n     },\n     logout() {\n       uni.showToast({ title: '退出登录', icon:'success' })\n       this.login_status = false\n       this.userInfo = \n       {\n         username: '未登录',\n         account_id: '',\n         description: '这个人很懒，什么都没有留下',\n         avatar: '/static/info/未登录.png',\n         level: 0,\n         activity: 0,\n         coupon: 0,\n         points: 0,\n         balance: 0\n       }\n     }\n   }\n };\n</script>\n\n<style lang=\"scss\" scoped>\n@import url(my_info.css);\n</style>","import MiniProgramPage from 'D:/CODE/vue/canteen_program/pages/my_info/my_info.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}